# SAGA Orchestrator Messages

## Checkout SAGA
### Successful SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
5. **Payment-SAGA**: `END-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
6. **SAGA-Order**: `START-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
7. **Order-SAGA**: `END-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
8. SAGA Done: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

### Stock Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
4. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

### Payment Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
5. **Payment-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
6. **SAGA-Stock**: `START-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
7. **Stock-SAGA**: `END-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
8. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

### Order Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
5. **Payment-SAGA**: `END-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
6. **SAGA-Order**: `START-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
7. **Order-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
8. **SAGA-Payment**: `START-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
9. **Payment-SAGA**: `END-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
10. **SAGA-Stock**: `START-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
11. **Stock-SAGA**: `END-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
12. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

## Order
### From Order (order-ack)
1. **Order-SAGA**: `START-CHECKOUT-SAGA_-1_{ORDER_JSON}`
2. ~~SAGA creates SAGA ID: `CREATE-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`~~
3. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
5. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
6. **Payment-SAGA**: `END-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
7. **SAGA-Order**: `START-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
8. **Order-SAGA**: `END-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
9. SAGA Done: `END-CHECKOUT-SAGA_{SAGA_ID}`

### Stock Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
4. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

### Payment Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
5. **Payment-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
6. **SAGA-Stock**: `START-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
7. **Stock-SAGA**: `END-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
8. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

### Order Fails SAGA
1. **Order-SAGA**: `START-CHECKOUT-SAGA_{}_{ORDER_JSON}`
2. **SAGA-Stock**: `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
3. **Stock-SAGA**: `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
4. **SAGA-Payment**: `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
5. **Payment-SAGA**: `END-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
6. **SAGA-Order**: `START-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
7. **Order-SAGA**: `ABORT-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`
8. **SAGA-Payment**: `START-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
9. **Payment-SAGA**: `END-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
10. **SAGA-Stock**: `START-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
11. **Stock-SAGA**: `END-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`
12. SAGA Successfully failed: `END-CHECKOUT-SAGA_{SAGA_ID}_{ORDER_JSON}`

## Order
### From Order (order-ack)
- `START-CHECKOUT-SAGA_{}_{ORDER_JSON}` the Order service fetches the Order object as JSON given its ID
- `END-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`
### To Order (order-syn)
- `START-UPDATE-ORDER_{SAGA_ID}_{ORDER_JSON}`

## Stock
### From Stock (stock-ack)
- `END-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
- `END-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`

### To Stock (stock-syn)
- `START-SUBTRACT-STOCK_{SAGA_ID}_{ORDER_JSON}`
- `START-READD-STOCK_{SAGA_ID}_{ORDER_JSON}`

## Payment
### From Payment (payment-ack)
- `END-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
- `END-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`

### To Payment (payment-syn)
- `START-MAKE-PAYMENT_{SAGA_ID}_{ORDER_JSON}`
- `START-CANCEL-PAYMENT_{SAGA_ID}_{ORDER_JSON}`

# SAGA Database Schema
Entry: name | saga-id | json-content | timestamp
PK: saga-id
